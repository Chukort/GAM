<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Dilaab Camp Master List</title>
    <link rel="stylesheet" href="reg.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="container" style="max-width: 1000px;">
        <div class="header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
            <div>
                <h2>Dilaab Camp 2026</h2>
                <p>Admin Master List</p>
            </div>
            <div class="stats-badge" style="margin-bottom: 20px; background: var(--border); padding: 10px 20px; border-radius: 12px; font-weight: 700;">
                Total: <span id="totalCount" style="color: var(--primary);">0</span>
            </div>
        </div>

        <div class="tabs-container" id="tabsList" style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;"></div>

        <div class="controls" style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="btn btn-submit" style="background: #10b981;" onclick="downloadPDF()">ðŸ“„ Download PDF</button>
            <button class="btn btn-add" style="margin: 0;" onclick="clearData()">Clear All Records</button>
        </div>

        <div class="table-responsive">
            <table id="adminTable">
                <thead>
                    <tr>
                        <th style="width: 50px;">#</th>
                        <th>Church Name</th>
                        <th>Participant Name</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="adminBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let currentFilter = "All";

        function loadData() {
            const data = JSON.parse(localStorage.getItem('campData')) || [];
            data.sort((a, b) => a.church.localeCompare(b.church) || a.name.localeCompare(b.name));
            renderTabs(data);
            renderTable(data);
        }

        function renderTabs(data) {
            const tabsList = document.getElementById('tabsList');
            const churches = ["All", ...new Set(data.map(item => item.church))];
            tabsList.innerHTML = churches.map(church => `
                <button class="tab ${currentFilter === church ? 'active' : ''}" onclick="setFilter('${church}')">
                    ${church}
                </button>
            `).join('');
        }

        function setFilter(church) {
            currentFilter = church;
            loadData();
        }

        function renderTable(data) {
            const body = document.getElementById('adminBody');
            const filteredData = currentFilter === "All" ? data : data.filter(item => item.church === currentFilter);
            document.getElementById('totalCount').innerText = filteredData.length;
            
            body.innerHTML = filteredData.length ? filteredData.map((item, i) => `
                <tr>
                    <td data-label="#">${i + 1}</td>
                    <td data-label="Church">${item.church}</td>
                    <td data-label="Name">${item.name}</td>
                    <td data-label="Date">${item.date}</td>
                </tr>
            `).join('') : '<tr><td colspan="4" style="text-align: center; padding: 40px;">No records found.</td></tr>';
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text(`Dilaab Camp 2026 - ${currentFilter} List`, 14, 15);
            doc.autoTable({ html: '#adminTable', startY: 25, theme: 'grid' });
            doc.save(`Dilaab_Camp_${currentFilter}.pdf`);
        }

        function clearData() {
            if(confirm("Permanently delete all records?")) {
                localStorage.removeItem('campData');
                location.reload();
            }
        }
        window.onload = loadData;
    </script>
</body>
</html>