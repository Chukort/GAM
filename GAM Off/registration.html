<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dilaab Camp Registration</title>
    <link rel="stylesheet" href="reg.css">
</head>
<body>

<div class="container">
    <header>
        <h2>Dilaab Camp 2026</h2>
        <p>Register your delegation below.</p>
    </header>
    
    <div class="form-group" style="margin-bottom: 20px;">
        <label for="churchSelect">Local Church</label>
        <select id="churchSelect" onchange="toggleOtherChurch(this.value)">
            <option value="">-- Choose Local Church --</option>
            <option value="GAM CANLAON">GAM CANLAON</option>
            <option value="GAM SAN CARLOS">GAM SAN CARLOS</option>
            <option value="GAM PAMPLONA">GAM PAMPLONA</option>
            <option value="GAM SAN JOSE">GAM SAN JOSE</option>
            <option value="GAM DUMAGUETE">GAM DUMAGUETE</option>
            <option value="HOPE CITY - GAM">HOPE CITY - GAM</option>
            <option value="Other">Other (Specify below)</option>
        </select>
    </div>

    <div id="otherDiv" class="form-group hidden" style="margin-bottom: 20px;">
        <label for="customChurch">Specify Church Name</label>
        <input type="text" id="customChurch" placeholder="Type your church name here...">
    </div>

    <div id="list" class="form-group" style="margin-top: 25px;">
        <label>Delegation Participants</label>
        <div class="participant-entry">
            <input type="text" class="p-name" placeholder="Full Name (e.g. Juan Dela Cruz)" required>
            <div style="width: 48px; flex-shrink: 0;"></div>
        </div>
    </div>

    <div style="margin-top: 25px; display: flex; flex-direction: column; gap: 12px;">
        <button type="button" class="btn btn-add" onclick="addRow()">+ Add Another Person</button>
        <button type="button" class="btn btn-submit" onclick="saveData()">Submit Registration</button>
    </div>
</div>

<div class="modal-overlay" id="successModal">
    <div class="modal-content">
        <span class="modal-icon">ðŸ”¥</span>
        <h2 style="background: none; -webkit-text-fill-color: var(--text-main); margin-bottom: 15px;">Registration Successful!</h2>
        <p style="color: var(--text-muted); margin-bottom: 20px;">Your delegation has been added to the master list.</p>
        
        <div style="padding: 20px; background: rgba(0,0,0,0.2); border-radius: 16px; border: 1px solid var(--border); margin-bottom: 25px;">
            <h3 style="color: white; margin: 0; letter-spacing: 2px;">DILAAB CAMP 2026</h3>
            <span class="theme-text">Theme: TUTOK</span>
            <span class="scripture-text">Hebrews 12:2</span>
        </div>
        
        <button class="btn btn-submit" onclick="closeModal()">Praise God!</button>
    </div>
</div>

<script>
    /**
     * Toggles visibility of the custom church input field.
     */
    function toggleOtherChurch(value) {
        const otherDiv = document.getElementById('otherDiv');
        if (value === 'Other') {
            otherDiv.classList.remove('hidden');
            otherDiv.style.display = 'block'; // Ensure visibility
            document.getElementById('customChurch').focus();
        } else {
            otherDiv.classList.add('hidden');
            otherDiv.style.display = 'none';
        }
    }

    /**
     * Dynamically adds a new row for participant names.
     */
    function addRow() {
        const list = document.getElementById('list');
        const div = document.createElement('div');
        div.className = 'participant-entry';
        div.style.marginTop = "12px";
        div.style.animation = "slideInLeft 0.3s ease-out";
        
        div.innerHTML = `
            <input type="text" class="p-name" placeholder="Full Name" required>
            <button class="btn btn-remove" onclick="this.parentElement.remove()" title="Remove Entry">âœ•</button>
        `;
        list.appendChild(div);
        
        // Auto-focus the new input field for faster typing
        div.querySelector('input').focus();
    }

    /**
     * Validates and saves data to the device's LocalStorage.
     */
    function saveData() {
        const churchSelect = document.getElementById('churchSelect');
        let church = churchSelect.value;
        
        if (church === 'Other') {
            church = document.getElementById('customChurch').value.trim();
        }
        
        // Validation: Ensure Church is selected/provided
        if (!church) {
            churchSelect.style.borderColor = 'var(--primary)';
            alert("Please select or specify your Local Church.");
            return;
        }

        const nameInputs = document.querySelectorAll('.p-name');
        let currentData = JSON.parse(localStorage.getItem('campData')) || [];
        let addedCount = 0;

        // Process each name input
        nameInputs.forEach(input => {
            const nameValue = input.value.trim();
            if (nameValue) {
                currentData.push({
                    church: church.toUpperCase(),
                    name: nameValue.toUpperCase(),
                    // Date formatted for easy sorting in Admin view
                    date: new Date().toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric', 
                        year: 'numeric' 
                    })
                });
                addedCount++;
            }
        });

        // Validation: Ensure at least one participant is listed
        if (addedCount === 0) {
            alert("Please enter at least one participant name.");
            return;
        }

        // Save to LocalStorage and trigger success UI
        localStorage.setItem('campData', JSON.stringify(currentData));
        document.getElementById('successModal').classList.add('active');
    }

    /**
     * Closes the modal and resets the form for the next entry.
     */
    function closeModal() {
        const modal = document.getElementById('successModal');
        modal.classList.remove('active');
        
        // Small delay to allow modal animation to finish before reload
        setTimeout(() => {
            location.reload();
        }, 400);
    }
</script>

</body>
</html>